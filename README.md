# Metal Analyzer

貴金属（ゴールド等）の市場価格を高度に分析し、トレンド判定や特定のチャートパターン（ダブルトップ等）を検知するためのPythonライブラリです。

## 特徴

- **👑 高精度トレンド分析ダッシュボード**: 4つの主要指標（長期トレンド、モメンタム、ボラティリティ加速、センチメント）を統合し、暴落や急騰を予測。
- **📈 マルチタイムフレーム対応**: 月・週・日・4時・1時・15分足の計6種類の時間足をサポート。
- **📊 プロフェッショナルなチャート生成**: ダークモードに対応し、EMA 20/50/200 と凡例を自動付与した高品質な `mplfinance` チャートを生成。
- **🔍 パターン検知**: 独自のフィルタリング技術による高精度なダブルトップ（Mトップ）検知。

## インストール

```bash
cd metal-analyzer
pip install .
```

---

## 使い方：3つのメイン・デモ

当ライブラリの全機能を体験するための3つのデモスクリプトが `examples/` フォルダに用意されています。

### 1. 総合分析デモ (`examples/demo.py`)
最新の市場データを用いて、全時間足のチャート生成と高度トレンド予測を一度に実行します。

#### コード例
```python
import yfinance as yf
from metal_analyzer import MetalAnalyzer

analyzer = MetalAnalyzer(ticker="GC=F")
# 各時間足データを取得して追加し、analyze_all()を実行
# ... (詳細は examples/demo.py 参照)
analyzer.analyze_all()
```

#### 実行結果（標準出力）
```text
=== Metal Analyzer 総合分析デモ ===
[1] データ取得およびチャート生成中...
[2] 高度なトレンド分析の解析
==================================================
   👑 高精度ゴールド分析ダッシュボード 👑
==================================================
【長期トレンド】 トレンド転換点/混在
【モメンタム】   下落の勢い強い
【加速/ボラ】    安定
【センチメント】 レンジ内
--------------------------------------------------
 🎯 最終予測: 続落注意
 ⚠️ リスク:   中
 📝 コメント: 下落バイアスが強いですが、本格的な加速にはまだ至っていません。
==================================================
```

#### 出力チャート
![Daily Chart](docs/images/chart_daily.png)
*(月足、週足、1時間足等も一括生成されます)*

---

### 2. 暴落加速シミュレーション (`examples/demo-20260130.py`)
歴史的な暴落局面（2026年1月30日）を再現し、ダブルトップのネックライン割れと下落加速シグナルを検知します。

#### 実行結果（標準出力）
```text
==================================================
   👑 高精度ゴールド分析ダッシュボード 👑
==================================================
【長期トレンド】 トレンド転換点/混在
【モメンタム】   下落の勢い強い
【加速/ボラ】    安定
【センチメント】 重要ライン割れ (暴落確定)
--------------------------------------------------
 🎯 最終予測: ⚠️ 大暴落加速 (Great Crash Acceleration)
 ⚠️ リスク:   極めて高い
 📝 コメント: 重要ラインを割り込み、ボラティリティが急増しています。トレンドの底が見えません。
==================================================
```

#### 出力チャート
![Scenario 20260130](docs/images/20260130_chart_daily.png)

---

### 3. 上昇トレンド転換シミュレーション (`examples/demo-20251230.py`)
レンジ相場から上昇に転じる局面（2025年12月30日）を再現し、底堅さの判定を検証します。

#### 実行結果（標準出力）
```text
==================================================
   👑 高精度ゴールド分析ダッシュボード 👑
==================================================
【長期トレンド】 トレンド転換点/混在
【モメンタム】   穏やか
【加速/ボラ】    安定
【センチメント】 レンジ内
--------------------------------------------------
 🎯 最終予測: 底堅い/反発
 ⚠️ リスク:   低
 📝 コメント: 買い圧力が優勢、またはレンジ下限での反発が見られます。
==================================================
```

#### 出力チャート
![Scenario 20251230](docs/images/20251230_chart_daily.png)

---

## プロジェクト構成

各ファイルの詳細な役割を以下に示します。

| フォルダ | ファイル | 説明 |
| :--- | :--- | :--- |
| `core/` | `analyzer.py` | メインクラス `MetalAnalyzer` 。データの管理、分析の実行、プロットの指示を統括。 |
| `indicators/` | `sma.py` | 移動平均線（SMA, EMA）の計算アルゴリズム。 |
| | `rsi.py` | 相対力指数（RSI）の計算アルゴリズム。 |
| `patterns/` | `double_top.py` | SciPyを用いたダブルトップ（Mトップ）検知ロジック。 |
| `models/` | `advanced_predictor.py` | 高精度トレンド予測エンジン。 |
| | `top_down.py` | マルチタイムフレーム分析ロジック。 |
| | `signal_entry.py` | エントリー・エグジット判定。 |
| `examples/` | `demo.py` | 総合分析デモスクリプト。 |
| | `demo-20260130.py` | 暴落局面シミュレーション。 |
| | `demo-20251230.py` | トレンド転換シミュレーション。 |
